<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/dashboard.css">
    <link rel="stylesheet" href="./assets/css/style_all.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./Js/gauge.min.js"></script>
    <script src="./Js/header.js"></script>
    <script src="./Js/logout.js"></script>
    <title>Dashboard</title>
</head>


<body onload="mudarheader()">
    <div class="container">
        <header>
            <nav class="nav-bar">
                <div class="logo">
                    <img src="./assets/imagens/logo_teste.png" alt="Logo GN" class="imgLogoHeader">
                    <div class="nomeLogoHeader">
                        <h2>MedServer</h2>
                        <p>Sentinels</p>
                    </div>
                </div>
                <div class="nav-list">
                    <ul>
                        <li class="nav-item"><a href="cadastro_filial.html" class="nav-link">Cadastrar Filiais</a></li>
                        <li class="nav-item"><a href="cadastro_funcionario.html" class="nav-link">Cadastrar
                                Funcionário</a></li>
                        <li class="nav-item"><a href="cadastro_maquina.html" class="nav-link">Cadastrar Máquina</a></li>
                        <li class="nav-item"><a href="configuracao_user.html" class="nav-link">Configurações</a></li>
                        <li class="nav-item"><a href="#" onclick="mostraParametrizacao()"
                                class="nav-link">Parametrizar</a></li>
                    </ul>
                </div>
                <div id="div_loginButton" class="login-button">
                    <button id="button_perfil" onclick="perfil()"><a id="aButton" href="#">Perfil</a></button>
                    <img id="img_login" onclick="perfil()" src="./assets/imagens/svg/perfil.svg" width="30px" alt="">
                </div>

                <div class="mobile-menu-icon">
                    <button onclick="abrirMenu()"><img class="icon" src="./assets/imagens/svg/menu_white_36dp.svg"
                            alt=""></button>
                </div>
            </nav>
            <div class="mobile-menu">
                <ul>
                    <li class="nav-item"><a href="#sobreNos" class="nav-link">Sobre nós</a></li>
                    <li class="nav-item"><a href="#servicos" class="nav-link">Serviços</a></li>
                    <li class="nav-item"><a href="#contato" class="nav-link"> Contato</a></li>
                </ul>

                <div id="div_loginButtonCel" class="login-button">
                    <button id="button_perfilCel" onclick="perfil()"><a href="#" id="aButtonCel">Perfil</a></button>
                </div>
            </div>
        </header>
        <div class="geral-conteudo">
            <div class="area-conteudo">
                <div class="grafico-principal">
                    <div class="metricas">
                        <div class="card-metrica-gauge">
                            <div class="container-gauge">
                                <h3>CPU</h3>
                                <canvas id="gaugeCpu"></canvas>
                            </div>
                            <div class="container-gauge">
                                <h3>RAM</h3>
                                <canvas id="gaugeRam"></canvas>
                            </div>
                            <div class="container-gauge">
                                <h3>Disco</h3>
                                <canvas id="gaugeDisco"></canvas>
                            </div>

                        </div>
                        <div class="card-metrica">
                            <h3 class="titulo">Quantidade de vezes que<br> hardware saiu do padrão:</h3>
                            <div class="container-metrica">
                                <div class="conteudo-metrica">
                                    <span>CPU</span>
                                    <h1>0</h1>
                                </div>
                                <div class="conteudo-metrica">
                                    <span>RAM</span>
                                    <h1>0</h1>
                                </div>
                                <div class="conteudo-metrica">
                                    <span>Disco</span>
                                    <h1>0</h1>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="dashboard">
                        <H1>Consumo de hardware - a cada X minutos</H1>
                        <!-- <div class="grafico-linha" style="width: 950px; height: 420px;"> -->
                        <div class="grafico-linha">
                            <canvas id="grafico-linha" style="width: 950px; height: 410px;"></canvas>
                        </div>
                    </div>

                </div>
                <div class="parametrizacao">
                    <h2>Parametrize os limites</h2>
                    <div class="container-alerta">
                        <h4>CPU:</h4>
                        <div class="alerta">

                            <div class="caixa-input">
                                <span>Moderado:</span>
                                <input type="number" id="alertaModeradoCpu">
                            </div>


                            <div class="caixa-input">
                                <span>Significativo:</span>
                                <input type="number" id="alertaSignificativoCpu">
                            </div>

                            <div class="caixa-input-critico">
                                <span>Crítico:</span>
                                <input type="number" id="alertaCriticoCpu">
                            </div>

                        </div>
                    </div>
                    <div class="container-alerta">
                        <h4>RAM:</h4>
                        <div class="alerta">

                            <div class="caixa-input">
                                <span>Moderado:</span>
                                <input type="number" id="alertaModeradoRam">
                            </div>


                            <div class="caixa-input">
                                <span>Significativo:</span>
                                <input type="number" id="alertaSignificativoRam">
                            </div>


                            <div class="caixa-input-critico">
                                <span>Crítico: </span>
                                <input type="number" id="alertaCriticoRam">
                            </div>

                        </div>
                    </div>
                    <div class="container-alerta">
                        <h4>Disco:</h4>
                        <div class="alerta">
                            <div class="caixa-input">
                                <span>Moderado:</span>
                                <input type="number" id="alertaModeradoDisco">
                            </div>
                            <div class="caixa-input">
                                <span>Significativo:</span>
                                <input type="number" id="alertaSignificativoDisco">
                            </div>
                            <div class="caixa-input-critico">
                                <span>Crítico: </span>
                                <input type="number" id="alertaCriticoDisco">
                            </div>
                        </div>
                    </div>
                    <h2>Parametrize o tempo</h2>
                    <div class="container-alerta-tempo">
                        <h4>Tempo:</h4>
                        <div class="alerta">
                            <div class="caixa-input-alerta">
                                <span>Intervalo de captura de dados:</span>
                                <select>
                                    <option value="2" selected>2 minutos</option>
                                    <option value="4">4 minutos</option>
                                    <option value="6">6 minutos</option>
                                    <option value="8">8 minutos</option>
                                    <option value="10">10 minutos</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="btn-parametrizacao">
                        <button class="btn-cancelar"
                            onclick="mostraParametrizacao(),atualizarParametro()">Cancelar</button>
                        <button class="btn-confirmar" onclick="parametrizacao()">Confirmar</button>
                    </div>
                </div>
                <div class="graficos-secundarios">
                    <div class="grafico">
                        <h3>Registro diário do consumo<br>de hardware</h3>
                        <canvas id="grafico-dia" style="width: 260px; height: 165px;"></canvas>
                    </div>
                    <div class="grafico">
                        <h3>Registro semanal do consumo<br>de hardware</h3>
                        <canvas id="grafico-semana" style="width: 260px; height: 165px;"></canvas>
                    </div>

                </div>

            </div>
            <div class="baixar-relatorio">
                <a href="">Baixar relatório</a>
            </div>
        </div>
    </div>
</body>

</html>

<script>

    function mostraParametrizacao() {
        var parametrizacao = document.querySelector('.parametrizacao');
        if (parametrizacao.style.display === 'flex') {
            parametrizacao.style.display = 'none';
        } else {
            parametrizacao.style.display = 'flex';
        }
    }

    const opts = {
        angle: 0,
        lineWidth: 0.2,
        radiusScale: 0.55,
        staticZones: [
            { strokeStyle: "#8BC34A", min: 0, max: 30 },
            { strokeStyle: "#FFEB3B", min: 30, max: 50 },
            { strokeStyle: "#FF9800", min: 50, max: 70 },
            { strokeStyle: "#F44336", min: 70, max: 100 }
        ],
        staticLabels: {
            font: "10px Montserrat",
            labels: [30, 50, 70],
            color: "#000000",
            fractionDigits: 0
        },
        pointer: {
            length: 0.45,
            strokeWidth: 0.018,
            color: '#0F0303'
        }
    };

    const gaugeCpu = new Gauge(document.getElementById("gaugeCpu")).setOptions(opts);
    gaugeCpu.maxValue = 100;
    gaugeCpu.minValue = 0;
    gaugeCpu.animationSpeed = 65;
    gaugeCpu.set(25);

    const gaugeRam = new Gauge(document.getElementById("gaugeRam")).setOptions(opts);
    gaugeRam.maxValue = 100;
    gaugeRam.minValue = 0;
    gaugeRam.animationSpeed = 65;
    gaugeRam.set(60);

    const gaugeDisco = new Gauge(document.getElementById("gaugeDisco")).setOptions(opts);
    gaugeDisco.maxValue = 100;
    gaugeDisco.minValue = 0;
    gaugeDisco.animationSpeed = 65;
    gaugeDisco.set(95);

    function parametrizacao() {
        const moderadoCpu = Number(alertaModeradoCpu.value);
        const significativoCpu = Number(alertaSignificativoCpu.value);
        const criticoCpu = Number(alertaCriticoCpu.value);
        const optsCpu = {
            staticZones: [
                { strokeStyle: "#8BC34A", min: 0, max: moderadoCpu },
                { strokeStyle: "#FFEB3B", min: moderadoCpu, max: significativoCpu },
                { strokeStyle: "#FF9800", min: significativoCpu, max: criticoCpu },
                { strokeStyle: "#F44336", min: criticoCpu, max: 100 }
            ],
            staticLabels: {
                font: "10px Montserrat",
                labels: [moderadoCpu, significativoCpu, criticoCpu],

            }
        };
        gaugeCpu.setOptions(optsCpu);

        const moderadoRam = Number(alertaModeradoRam.value);
        const significativoRam = Number(alertaSignificativoRam.value);
        const criticoRam = Number(alertaCriticoRam.value);
        const optsRam = {
            staticZones: [
                { strokeStyle: "#8BC34A", min: 0, max: moderadoRam },
                { strokeStyle: "#FFEB3B", min: moderadoRam, max: significativoRam },
                { strokeStyle: "#FF9800", min: significativoRam, max: criticoRam },
                { strokeStyle: "#F44336", min: criticoRam, max: 100 }
            ],
            staticLabels: {
                font: "10px Montserrat",
                labels: [moderadoRam, significativoRam, criticoRam],

            }
        };
        gaugeRam.setOptions(optsRam);

        const moderadoDisco = Number(alertaModeradoDisco.value);
        const significativoDisco = Number(alertaSignificativoDisco.value);
        const criticoDisco = Number(alertaCriticoDisco.value);
        const optsDisco = {
            staticZones: [
                { strokeStyle: "#8BC34A", min: 0, max: moderadoDisco },
                { strokeStyle: "#FFEB3B", min: moderadoDisco, max: significativoDisco },
                { strokeStyle: "#FF9800", min: significativoDisco, max: criticoDisco },
                { strokeStyle: "#F44336", min: criticoDisco, max: 100 }
            ],
            staticLabels: {
                font: "10px Montserrat",
                labels: [moderadoDisco, significativoDisco, criticoDisco],

            }
        };
        gaugeDisco.setOptions(optsDisco);
    }

    const grafico1 = document.getElementById('grafico-linha');

    new Chart(grafico1, {
        type: 'line',
        data: {
            labels: ['20:55', '20:56', '20:57', '20:58', '20:59', '21:00',],
            datasets: [
                {
                    label: 'CPU',
                    data: [87, 43, 65, 92, 28, 77],
                    borderColor: '#FF5733',
                    backgroundColor: '#FF5733',
                },
                {
                    label: 'RAM',
                    data: [78, 42, 93, 27, 65, 89],
                    borderColor: '#33FF6B',
                    backgroundColor: '#33FF6B',
                },
                {
                    label: 'Disco',
                    data: [82, 78, 76, 85, 73, 88],
                    borderColor: '#339CFF',
                    backgroundColor: '#339CFF',
                }
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const grafico2 = document.getElementById('grafico-dia');

    new Chart(grafico2, {
        type: 'bar',
        data: {
            labels: ['00h', '03h', '06h', '09h', '12h', '15h', '18h', '21h'],
            datasets: [
                {
                    label: 'CPU',
                    data: [87, 43, 65, 92, 28, 77, 54, 68],
                    borderColor: '#FF5733',
                    backgroundColor: '#FF5733',
                },
                {
                    label: 'RAM',
                    data: [78, 42, 93, 27, 65, 89, 59, 81],
                    borderColor: '#33FF6B',
                    backgroundColor: '#33FF6B',
                },
                {
                    label: 'Disco',
                    data: [82, 78, 76, 85, 73, 88, 61, 75],
                    borderColor: '#339CFF',
                    backgroundColor: '#339CFF',
                }
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const grafico3 = document.getElementById('grafico-semana');

    new Chart(grafico3, {

        type: 'bar',
        data: {
            labels: ['19/04', '20/04', '21/04', '22/04', '23/04', '24/04', '25/04'],
            datasets: [
                {
                    label: 'CPU',
                    data: [87, 43, 65, 92, 28, 77, 54, 68],
                    borderColor: '#FF5733',
                    backgroundColor: '#FF5733',
                },
                {
                    label: 'RAM',
                    data: [78, 42, 93, 27, 65, 89, 59, 81],
                    borderColor: '#33FF6B',
                    backgroundColor: '#33FF6B',
                },
                {
                    label: 'Disco',
                    data: [82, 78, 76, 85, 73, 88, 61, 75],
                    borderColor: '#339CFF',
                    backgroundColor: '#339CFF',
                }
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    function atualizarParametro() {

    }
    function atualizarParametroCPU() {



        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo

        var moderadoCpu = alertaModeradoCpu.value;
        var significativoCpu = alertaSignificativoCpu.value;
        var criticoCpu = alertaCriticoCpu.value;

        if (moderadoCpu == "" || significativoCpu == "" || criticoCpu == "") {
            alert(" campo vazios")
        } else {

            // Enviando o valor da nova input
            fetch("/usuarios/parametros", {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    significativoCpu: significativoCpu,
                    moderadoCpu: moderadoCpu,
                    criticoCpu: criticoCpu,
                })
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    console.log("Fazer alguma coisa")

                    alert("parametros atualizados");

                } else {
                    throw ("erros ao atualizar parametros");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;
        }
    }

   





</script>